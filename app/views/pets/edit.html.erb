<!-- ãƒšãƒƒãƒˆç·¨é›†ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="pet-edit-header">
  <div class="pet-edit-content">
    <h1 class="pet-edit-title">ğŸ¾ ãƒšãƒƒãƒˆæƒ…å ±ã‚’ç·¨é›†</h1>
    <p class="pet-edit-subtitle"><%= @pet.name %>ã®æƒ…å ±ã‚’æ›´æ–°ã—ã¦ãã ã•ã„</p>
  </div>
  <div class="pet-edit-actions">
    <%= link_to "æˆ»ã‚‹", @pet, class: "btn btn-outline" %>
  </div>
</div>

<!-- ãƒšãƒƒãƒˆç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="pet-edit-container">
  <div class="pet-edit-card">
    <div class="pet-edit-header-card">
      <h2 class="pet-edit-card-title">ãƒšãƒƒãƒˆã®è©³ç´°æƒ…å ±</h2>
      <p class="pet-edit-card-subtitle">åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    </div>
    
    <div class="pet-edit-form">
      <%= form_with model: @pet, local: true, multipart: true, class: "pet-form" do |form| %>
        <% if @pet.errors.any? %>
          <div class="alert alert-danger">
            <h4><%= pluralize(@pet.errors.count, "error") %> prohibited this pet from being saved:</h4>
            <ul>
              <% @pet.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <% if @pet.errors[:profile_image].any? %>
          <div class="alert alert-danger">
            <ul>
              <% @pet.errors[:profile_image].each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ -->
        <div class="form-group pet-image-group">
          <label class="form-label">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ</label>
          <div class="pet-image-container">
            <div class="pet-image-preview">
              <% if @pet.profile_image.attached? %>
                <%= image_tag @pet.profile_image.variant(resize_to_fill: [120, 120]), alt: "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ", class: "pet-image", id: "pet-image-preview" %>
              <% else %>
                <img src="<%= @pet.profile_image_url %>" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ" class="pet-image" id="pet-image-preview">
              <% end %>
            </div>
            <div class="pet-image-actions">
              <%= form.file_field :profile_image, class: "form-control-file", id: "pet-image-input", accept: "image/jpeg,image/png,image/gif,image/webp" %>
              <label for="pet-image-input" class="btn btn-outline">å†™çœŸã‚’é¸æŠ</label>
              <% if @pet.profile_image.attached? %>
                <div class="checkbox-group">
                  <%= form.check_box :remove_profile_image, class: "checkbox-input", id: "remove-profile-image" %>
                  <label for="remove-profile-image" class="checkbox-label">
                    <span class="checkbox-text">ç¾åœ¨ã®å†™çœŸã‚’å‰Šé™¤</span>
                  </label>
                </div>
              <% end %>
            </div>
          </div>
          <div class="form-help">
            <span class="help-icon">ğŸ’¡</span>
            JPEGã€PNGã€GIFã€WebPå½¢å¼ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ï¼ˆæœ€å¤§5MBï¼‰
          </div>
        </div>

        <div class="form-group">
          <%= form.label :name, "åå‰", class: "form-label" %>
          <%= form.text_field :name, class: "form-control", placeholder: "ä¾‹: ãƒãƒ" %>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= form.label :species, "ç¨®é¡", class: "form-label" %>
            <%= form.select :species, 
                            [["çŠ¬", "çŠ¬"], ["çŒ«", "çŒ«"], ["ã†ã•ã", "ã†ã•ã"], ["ãƒãƒ ã‚¹ã‚¿ãƒ¼", "ãƒãƒ ã‚¹ã‚¿ãƒ¼"], ["ãã®ä»–", "ãã®ä»–"]], 
                            { prompt: "é¸æŠã—ã¦ãã ã•ã„" }, 
                            { class: "form-control" } %>
          </div>

          <div class="form-group">
            <%= form.label :sex, "æ€§åˆ¥", class: "form-label" %>
            <%= form.select :sex, 
                            [["ã‚ªã‚¹", "ã‚ªã‚¹"], ["ãƒ¡ã‚¹", "ãƒ¡ã‚¹"], ["ä¸æ˜", "ä¸æ˜"]], 
                            { prompt: "é¸æŠã—ã¦ãã ã•ã„" }, 
                            { class: "form-control" } %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <%= form.label :birthdate, "èª•ç”Ÿæ—¥", class: "form-label" %>
            <%= form.date_field :birthdate, class: "form-control" %>
          </div>

          <div class="form-group">
            <%= form.label :weight_kg, "ä½“é‡ (kg)", class: "form-label" %>
            <%= form.number_field :weight_kg, class: "form-control", step: 0.1, placeholder: "ä¾‹: 5.5" %>
          </div>
        </div>

        <div class="form-group">
          <%= form.label :breed_id, "çŠ¬ç¨®", class: "form-label" %>
          <%= form.select :breed_id, 
                          Breed.all.map { |breed| [breed.name, breed.id] }, 
                          { prompt: "é¸æŠã—ã¦ãã ã•ã„" }, 
                          { class: "form-control" } %>
        </div>

        <div class="form-group">
          <%= form.label :notes, "ãƒ¡ãƒ¢", class: "form-label" %>
          <%= form.text_area :notes, class: "form-control", rows: 3, placeholder: "ç‰¹è¨˜äº‹é …ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„" %>
        </div>

        <div class="form-actions">
          <%= form.submit "ãƒšãƒƒãƒˆæƒ…å ±ã‚’æ›´æ–°", class: "btn btn-primary btn-lg btn-full" %>
          <%= link_to "æˆ»ã‚‹", @pet, class: "btn btn-outline btn-lg btn-full" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const petImageInput = document.getElementById('pet-image-input');
  const petImagePreview = document.getElementById('pet-image-preview');
  const removeProfileImageCheckbox = document.getElementById('remove-profile-image');

  petImageInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        petImagePreview.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });

  if (removeProfileImageCheckbox) {
    removeProfileImageCheckbox.addEventListener('change', function() {
      if (this.checked) {
        petImagePreview.src = 'https://ui-avatars.com/api/?name=ãƒšãƒƒãƒˆ&background=random&color=fff&size=200';
        petImageInput.value = '';
      } else {
        <% if @pet.profile_image.attached? %>
          petImagePreview.src = '<%= @pet.profile_image_url %>';
        <% else %>
          petImagePreview.src = 'https://ui-avatars.com/api/?name=ãƒšãƒƒãƒˆ&background=random&color=fff&size=200';
        <% end %>
      }
    });
  }
});
</script>
