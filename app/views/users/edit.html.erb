<!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="profile-edit-header">
  <div class="profile-edit-content">
    <h1 class="profile-edit-title">
      <%= image_tag "icons/user.jpeg", alt: "ãƒ¦ãƒ¼ã‚¶ãƒ¼", class: "icon-inline" %>
      ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†
    </h1>
    <p class="profile-edit-subtitle">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’æ›´æ–°ã—ã¦ãã ã•ã„</p>
  </div>
  <div class="profile-edit-actions">
    <%= link_to "æˆ»ã‚‹", mypage_path, class: "btn btn-outline" %>
  </div>
</div>

<!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="profile-edit-container">
  <div class="profile-edit-card">
    <div class="profile-edit-header-card">
      <h2 class="profile-edit-card-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h2>
      <p class="profile-edit-card-subtitle">åŸºæœ¬æƒ…å ±ã¨ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸã‚’è¨­å®š</p>
    </div>
    
    <div class="profile-edit-form">
      <%= form_with model: @user, url: mypage_path, method: :patch, local: true, multipart: true, class: "profile-form" do |form| %>
        <% if @user.errors.any? %>
          <div class="alert alert-danger">
            <h4><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h4>
            <ul>
              <% @user.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ -->
        <div class="form-group profile-image-group">
          <label class="form-label">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ</label>
          <div class="profile-image-container">
            <div class="profile-image-preview">
              <img src="<%= @user.profile_image_url %>" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ" class="profile-image" id="profile-image-preview">
            </div>
            <div class="profile-image-actions">
              <%= form.file_field :profile_image, class: "form-control-file", id: "profile-image-input", accept: "image/*" %>
              <label for="profile-image-input" class="btn btn-outline">å†™çœŸã‚’é¸æŠ</label>
              <button type="button" class="btn btn-outline" id="remove-image">å‰Šé™¤</button>
            </div>
          </div>
          <div class="form-help">
            <span class="help-icon">ğŸ’¡</span>
            JPGã€PNGã€GIFå½¢å¼ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ï¼ˆæœ€å¤§5MBï¼‰
          </div>
        </div>

        <div class="form-group">
          <%= form.label :name, "åå‰", class: "form-label" %>
          <%= form.text_field :name, class: "form-control", placeholder: "ä¾‹: ç”°ä¸­å¤ªéƒ" %>
        </div>

        <div class="form-group">
          <%= form.label :email, "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", class: "form-label" %>
          <%= form.email_field :email, class: "form-control" %>
        </div>

        <div class="form-actions">
          <%= form.submit "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°", class: "btn btn-primary btn-lg btn-full" %>
          <%= link_to "æˆ»ã‚‹", mypage_path, class: "btn btn-outline btn-lg btn-full" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const profileImageInput = document.getElementById('profile-image-input');
  const profileImagePreview = document.getElementById('profile-image-preview');
  const removeImageBtn = document.getElementById('remove-image');

  profileImageInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        profileImagePreview.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });

  removeImageBtn.addEventListener('click', function() {
    profileImageInput.value = '';
    profileImagePreview.src = '<%= @user.profile_image_url %>';
  });
});
</script>
